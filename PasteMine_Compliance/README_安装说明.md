# PasteMine v1.1 安装说明

## 📦 已生成文件

本次构建生成了以下文件（位于 `/Users/lemonstyle/Documents/xcode_pj/pas_cc/`）：

- **PasteMine-1.1.dmg** (428 KB) - DMG 安装包，推荐用于分发
- **PasteMine.app** - 应用程序包，可直接使用

## 🚀 安装方法

### 方法一：使用 DMG 安装包（推荐）

1. 双击打开 `PasteMine-1.1.dmg`
2. 将 `PasteMine` 拖拽到 `Applications` 文件夹
3. 打开 Launchpad 或 Applications 文件夹，找到 PasteMine 并启动

### 方法二：直接使用 App 文件

1. 将 `PasteMine.app` 复制到 `/Applications` 文件夹
2. 或者直接双击 `PasteMine.app` 运行

## ⚠️ 首次运行注意事项

首次运行时，macOS 可能会提示安全警告，请按以下步骤操作：

### 如果提示"无法打开，因为来自身份不明的开发者"

1. 右键点击 `PasteMine.app`
2. 选择"打开"
3. 在弹出的对话框中点击"打开"

或者在终端执行：
```bash
xattr -cr /Applications/PasteMine.app
```

### 权限设置

首次启动后，PasteMine 需要以下权限：

1. **通知权限** - 用于显示复制/粘贴通知
   - 打开：系统设置 > 通知 > PasteMine > 允许通知

2. **辅助功能权限** - 用于实现自动粘贴功能
   - 打开：系统设置 > 隐私与安全性 > 辅助功能 > 添加 PasteMine

## 🔒 隐私与权限策略（2025-12 更新）

- **剪贴板历史默认关闭**：首次启动会在 Onboarding 第 3 步提示“启用剪贴板历史记录”开关，只有用户勾选后才会开始记录历史。
- **数据仅保存在本机沙盒**：所有 Core Data 和图片文件都位于 `~/Library/Containers/com.lemonstyle.PasteMine/Data/Library/Application Support/PasteMine/`，用户可随时在设置中停用或清空。
- **默认忽略敏感来源**：内置忽略 1Password、KeePass 等密码管理器及多个密码类型的 Pasteboard Type，避免误记录密码或一次性验证码。
- **辅助功能权限缺失时自动降级**：若未授予辅助功能权限，历史窗口顶部会显示 Banner，同时自动粘贴降级为“仅复制”，并通过通知提醒用户前往系统设置开启。
- **开机自启动支持 macOS 13+**：开关仅在 macOS 13 及以上可用，低版本会显示“仅支持 macOS 13+”提示。

## 🆕 v1.1 新增功能

### 隐私设置增强

在设置页面 > 隐私选项卡中，新增三个重要功能：

#### 1. 忽略应用列表
- 允许用户手动添加应用名称
- 这些应用中的复制操作不会被记录
- 使用场景：密码管理器、私密笔记等

**使用方法：**
1. 打开设置 > 隐私
2. 在"忽略应用"区域点击"添加"
3. 输入应用名称（如 "1Password", "Safari"）
4. 点击确认

#### 2. 忽略复制类型列表
- 自动过滤敏感的剪贴板类型
- 默认包含 8 种常见敏感类型：
  - org.nspasteboard.ConcealedType（隐藏型，多用于密码）
  - org.nspasteboard.TransientType（临时）
  - org.nspasteboard.AutoGeneratedType（自动生成）
  - Pasteboard generator type
  - com.agilebits.onepassword
  - com.typeit4me.clipping
  - de.petermaurer.TransientPasteboardType
  - net.antelle.keeweb
- 用户可继续添加或删除类型

**使用方法：**
1. 打开设置 > 隐私
2. 在"忽略复制类型"区域查看默认列表
3. 可以删除不需要的类型，或添加新的类型

#### 3. 退出时清空剪贴板
- 新增开关，默认关闭
- 启用后，手动退出应用时自动清除所有历史记录
- 不影响应用的持久化存储功能
- 电脑重启后，如果未启用此功能，数据仍然保留

**使用方法：**
1. 打开设置 > 隐私
2. 找到"退出时清空剪贴板"开关
3. 根据需要开启或关闭

### 通知修复
- 修复通知不稳定问题（来自 notice 分支）
- 添加权限状态缓存
- 添加通知节流机制（0.3秒间隔）
- 优化音效播放逻辑

## 📋 功能说明

### 核心功能
- **剪贴板监听**：自动记录复制的文本和图片
- **历史记录**：快捷键 ⌘⇧V 打开历史记录窗口
- **快速粘贴**：从历史记录中选择内容，自动粘贴到当前应用
- **通知提醒**：复制和粘贴时显示通知
- **音效反馈**：复制和粘贴时播放音效

### 通用设置
- 通知开关
- 音效开关
- 全局快捷键自定义
- 开机自启动（macOS 13+）

### 存储设置
- 历史记录上限（50/200/永久）
- 忽略大图片（>20MB）

### 隐私设置（新增）
- 忽略应用列表
- 忽略复制类型列表
- 退出时清空剪贴板

## 🗑️ 卸载方法

如需卸载 PasteMine：

1. 退出 PasteMine 应用（从菜单栏图标点击"退出"）
2. 将 `/Applications/PasteMine.app` 移到废纸篓
3. 删除应用数据（可选）：
   ```bash
   rm -rf ~/Library/Application\ Support/com.lemonstyle.PasteMine
   rm -rf ~/Library/Preferences/com.lemonstyle.PasteMine.plist
   rm -rf ~/Library/Caches/com.lemonstyle.PasteMine
   ```

## 📝 开发信息

- 版本：1.1
- Bundle ID：com.lemonstyle.PasteMine
- 分支：主分支（合并了 notice 分支的修复）
- 构建时间：2025-12-02

## 🐛 问题反馈

如果遇到问题，请检查以下内容：

1. 确认已授予必要的系统权限
2. 查看控制台日志（可使用 Console.app 查看）
3. 确认系统版本兼容性（macOS 14.0+）

## 📝 版本历史

### v1.1 (2025-12-02)
- 新增：忽略应用列表功能
- 新增：忽略复制类型列表功能
- 新增：退出时清空剪贴板开关
- 修复：通知不稳定问题

### v1.0
- 初始版本
- 基础剪贴板监听和历史记录功能

## 📝 App Review Notes（提交前复制到 App Store Connect）

1. **自动粘贴触发条件**：用户通过菜单栏或⌘⇧V 打开窗口，手动选择历史项后才会复制内容；若辅助功能权限已授予，将在窗口关闭后向前台应用发送一次 Cmd+V Apple Event。
2. **Apple Events 用途**：仅用于在用户选择“自动粘贴”时，把所选内容回填到前台应用；未授予权限时会降级为仅复制并提示用户。
3. **剪贴板访问范围**：只在用户启用剪贴板历史开关后记录最近内容；默认对密码管理器等敏感来源/类型执行忽略，所有数据仅存储在本地沙盒，可随时停用或清空。
4. **隐私过滤与本地策略**：内置忽略 1Password、KeePass、Bitwarden 等常见密码管家以及 Concealed/Transient/Pasteboard generator 等类型，防止采集机密数据；图片原始数据保存在沙盒目录。
5. **Manifest 对齐**：`PasteMine/PrivacyInfo.xcprivacy` 已声明 `NSPrivacyCollectedDataTypeUserContent`、`NSPrivacyCollectedDataTypeUsageDataProductInteraction`，以及 `NSPrivacyAccessedAPICategoryPasteboard (C617.1)` 与 `NSPrivacyAccessedAPICategoryAppleEvents (7B41.1)`，App Store Connect 问卷使用相同描述。

---

享受使用 PasteMine v1.1！ 📋✨🔒
